options:
	cmd: commit

on script load:
	set {command::{@cmd}::poziom} to 10
	set {command::{@cmd}::cooldown} to 0 seconds

	set {command::{@cmd}::opis} to "Aktualizuje pliki"
	set {command::{@cmd}::kategoria} to "Deweloperskie"
	set {command::{@cmd}::uzycie} to "commit (info|pull)"

discord command {@cmd} [<text>]:
	aliases: git,
	prefixes: "%{bot::prefix}%", "%mention tag of event-bot%"
	trigger:
		if arg-1 is not set:
			KamilAPI cmd error "Użyj: %{bot::prefix}%commit (info|pull)"
		if arg-1 is not "info" or "pull":
			KamilAPI cmd error "Użyj: %{bot::prefix}%commit (info|pull)"
		set {_l} to getConfigEmote("loading")

		if arg-1 is "info":
			reply with "%{_l}% Ładuje..." and store it in {v::update::botmsg}
			run script at "plugins\Skript\scripts\0024B0T\commit.bat"

			while true:
				wait a tick
				set {_commit::*} to lines from file "plugins\Skript\scripts\0024B0T\log.api"
				if {_commit::1} is set:
					stop loop
				else:
					add 1 to {_nokurwaniema}
				if {_nokurwaniema} >= 100:
					KamilAPI cmd error "Po **5** sekundach nie utworzył się plik `log.api`! Anuluje komendę..."

			send a request to "https://api.github.com/repos/KAMIL0024/0024B0T/commits/%{_commit::1}%"
			map json body of last http response to {_r::*}
			loop {_r::files::*}:
				loop {_r::files::%loop-index%::*}:
					if loop-index-2 is "filename":
						add "%loop-value-2%%nl%" to {_edytowane::*}

			set {_xD} to "```%nl%%{_edytowane::*}%%nl%```"
			replace all ", " and " and " with "" in {_xD}

			create embed:
				set the colour of the embed to color of getColor(event-member)
				set the timestamp of embed to now
				set the footer of embed to footer with text "Commit info" and icon "%avatar of event-bot%"
				if {_edytowane::1} is set:
					set the description of embed to "Zmienione pliki:%nl% %{_xD}%"

				add field named "Aktualny commit" with value "[Klik](%{_r::parents::1::html_url}%)" to embed
				add field named "Author" with value "[%{_r::author::login}%](%{_r::author::html_url}%)" to embed
				add field named "Treść commita" with value "%{_r::commit::message}%" to embed
				add field named "Staty" with value "Dodane linijki: %{_r::stats::additions}%%nl%Usunięte linijki: %{_r::stats::deletions}%" to embed
				set the thumbnail of embed to "%{_r::author::avatar_url}%"

			edit {v::update::botmsg} to show last created embed
			edit {v::update::botmsg} to show " "
			KamilAPI add emote "green" to event-message
			delete {v::update::botmsg}
			wait 15 tick
			delete file "plugins\Skript\scripts\0024B0T\log.api"
			stop

		if arg-1 is "pull":
			reply with "%{_l}% Aktualizuje pliki..." and store it in {v::update::botmsg}
			run script at "plugins\Skript\scripts\0024B0T\pull.bat"
			while true:
				wait a tick
				set {_pull::*} to lines from file "plugins\Skript\scripts\0024B0T\pull.api"
				if {_pull::1} is set:
					stop loop

			set {_xD} to "```%nl%%{_pull::*}%%nl%```"
			replace all ", " and " and " with "" in {_xD}

			if {_xd} is "```%nl%Already up to date.%nl%```":
				deleteMessage({v::update::botmsg}, 0)
				delete file "plugins\Skript\scripts\0024B0T\pull.api"
				KamilAPI cmd error "Najnowsza aktualizacja jest już wgrana!" to event-message

			create embed:
				set the colour of the embed to color of getColor(event-member)
				set the timestamp of embed to now
				set the footer of embed to footer with text "Commit info" and icon "%avatar of event-bot%"
				set the description of embed to "Treść gita: %{_xD}%"

			edit {v::update::botmsg} to show last created embed
			edit {v::update::botmsg} to show " "
			delete {v::update::botmsg}
			KamilAPI add emote "green" to event-message
			delete file "plugins\Skript\scripts\0024B0T\pull.api"