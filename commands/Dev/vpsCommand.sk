options:
	cmd: vps

on script load:
	set {command::{@cmd}::poziom} to 10
	set {command::{@cmd}::cooldown} to 0 seconds

	set {command::{@cmd}::opis} to "Wy≈õwietla specyikacje maszyny"
	set {command::{@cmd}::kategoria} to "Deweloperskie"
	set {command::{@cmd}::uzycie} to "vps"

import:
	java.io.BufferedReader
	java.io.IOException
	java.io.InputStreamReader
	java.io.PrintWriter
	java.math.BigInteger
	java.net.URL
	java.net.URLConnection
	java.security.MessageDigest
	java.util.Date
	java.util.HashMap
	java.util.Map

function getMd5(s: text) :: string:
	set {_md} to MessageDigest.getInstance("MD5")
	{_md}.update({_s}.getBytes())
	return new BigInteger(1, {_md}.digest()).toString(16)

effect KamilAPI send post with %string% and param[metrs] %string% in %event%:
	trigger:
		delay the effect
		set {_url} to expr-1
		set {_param} to expr-2
		set {_event} to expr-3

		set {_realUrl} to new URL({_url})

		set {_conn} to {_realUrl}.openConnection()

		{_conn}.setRequestProperty("accept", "text/xml,text/javascript,text/html,application/json")
		{_conn}.setRequestProperty("connection", "Keep-Alive")

		{_conn}.setDoOutput(true)
		{_conn}.setDoInput(true)

		set {_out} to new PrintWriter({_conn}.getOutputStream())

		{_out}.print({_param})

		{_out}.flush()

		set {_reader} to new BufferedReader(new InputStreamReader({_conn}.getInputStream()))

		set {_builder} to ""
		if {_reader}.ready():
			loop 100 times:
				set {_line} to {_reader}.readLine()
				if {_line} is not set:
					stop loop

				if {_builder} is set:
					set {_builder} to "%{_builder}%%{_line}%%nl%"
				else:
					set {_builder} to "%{_line}%%nl%"

				delete {_line}

		log("%{_builder}%")
		KamilAPI set var {_json} to "%{_builder}%" in {_event}
		continue

discord command {@cmd} [<text>]:
	prefixes: "%{bot::prefix}%", "%{bot::helpmention}%" 
	trigger:
		set {_btSign} to "10r7KXYKnzzJXyFI4pCSxtUMCmWlvYjB"
		set {_url} to "https://kamil0024.me:2137/system?action=GetSystemTotal"
		set {_timestamp} to "%new Date().getTime()%"
		set {_md5Sign} to getMd5({_btSign})
		set {_temp} to "%{_timestamp}%%{_md5Sign}%"
		set {_token} to getMd5({_temp})
		set {_json} to "request_time=%{_timestamp}%&request_token=%{_token}%"

		KamilAPI send post with {_url} and param {_json} in event
		
		reply with "%{_json}%"

		KamilAPI add emote "green" to event-message of event-user

